<?php namespace {{namespace}};

use {{appnamespace}}\Http\Requests\CommentRequest;
use ComposeDe\Blogify\Models\Comment;
use ComposeDe\Blogify\Models\Post;

class CommentsController extends Controller
{

    /**
     * @var Comment
     */
    protected $comment;

    /**
     * @var mixed
     */
    protected $config;

    /**
     * @var Post
     */
    protected $post;

    protected $auth;

    /**
     * @param Comment $comment
     * @param Post $post
     */
    public function __construct(Comment $comment, Post $post)
    {
        $this->comment = $comment;
        $this->config = objectify(config('blogify'));
        $this->post = $post;
        $this->auth = BlogifyAuth::getFacadeRoot();
    }


    public function store(CommentRequest $request)
    {
        $comment = new Comment;
        $comment->hash = blogify()->makeHash('comments', 'hash', true);
        $comment->content = $request->comment;
        $comment->user_id = $this->auth->id();
        $comment->post_id = $this->post->byHash($request->post)->id;
        $comment->revised = ($this->config->approve_comments_first) ? 1 : 2;
        $comment->save();

        session()->flash('notify', [ 'success', 'Your comment has been added' ] );

        return back();
    }

}
